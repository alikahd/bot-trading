# ๐ ุฏููู ุงููุฒุงููุฉ ุงูุณุฑูุนุฉ ูุงูุชุญูู ูู ุงูุงุดุชุฑุงู ูุงูุฏูุน

## ๐ **ูุธุฑุฉ ุนุงูุฉ:**

ุชู ุชุทุจูู ูุธุงู ูุฒุงููุฉ ูุญุณูู ููุชุญูู ุงูุณุฑูุน ูู ุญุงูุฉ ุงูุงุดุชุฑุงู ูุงูุฏูุน ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชุทุจูู.

---

## โก **ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**

### 1๏ธโฃ **ูุฒุงููุฉ ุชููุงุฆูุฉ ูู ุฏูููุฉ** (simpleAuthService.ts)

```typescript
// ูุฒุงููุฉ ุชููุงุฆูุฉ ูู ุงูุฎูููุฉ
private startAutoSync() {
  setInterval(async () => {
    if (this.authState.isAuthenticated && this.authState.user) {
      console.log('๐ ูุฒุงููุฉ ุชููุงุฆูุฉ - ุงูุชุญูู ูู ุชุญุฏูุซุงุช ุงูุงุดุชุฑุงู ูุงูุฏูุน...');
      await this.refreshUserData();
    }
  }, 60000); // ูู ุฏูููุฉ
}
```

**ุงูููุงุฆุฏ:**
- โ ุงูุชุญูู ุงูุชููุงุฆู ูู ุชุญุฏูุซุงุช ุงูุงุดุชุฑุงู ูู ุฏูููุฉ
- โ ุงูุชุดุงู ููุฑู ูุฃู ุชุบููุฑุงุช ูู ุญุงูุฉ ุงูุฏูุน
- โ ุชุญุฏูุซ ุชููุงุฆู ูููุงุฌูุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ

---

### 2๏ธโฃ **ุฏุงูุฉ ุงูุชุญุฏูุซ ุงูููุฑู** (refreshUserData)

```typescript
// ุชุญุฏูุซ ููุฑู ูุจูุงูุงุช ุงููุณุชุฎุฏู (ูููุฒุงููุฉ ุงูุณุฑูุนุฉ)
async refreshUserData(): Promise<void> {
  if (!this.authState.user) return;
  
  console.log('โก ุชุญุฏูุซ ููุฑู ูุจูุงูุงุช ุงููุณุชุฎุฏู...');
  const { data: session } = await supabase.auth.getSession();
  
  if (session?.session) {
    await this.loadUserData(session.session.user.id);
    console.log('โ ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุจูุฌุงุญ');
  }
}
```

**ุงูุงุณุชุฎุฏุงู:**
```typescript
// ูููู ุงุณุชุฏุนุงุคูุง ูุฏููุงู ุนูุฏ ุงูุญุงุฌุฉ
await authService.refreshUserData();
```

---

### 3๏ธโฃ **ุงูุชุญูู ุงูููุฑู ูู ุชุงุฑูุฎ ุงูุงูุชูุงุก**

```typescript
// โ ุชุญูู ุฅุถุงูู ูู ุชุงุฑูุฎ ุงูุชูุงุก ุงูุงุดุชุฑุงู
if (data.subscription_end_date) {
  const endDate = new Date(data.subscription_end_date);
  const now = new Date();
  
  if (endDate < now) {
    console.log('โ๏ธ ุงูุงุดุชุฑุงู ููุชูู - ุชุญุฏูุซ ุงูุญุงูุฉ');
    // ุชุญุฏูุซ ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    await supabase
      .from('users')
      .update({ 
        subscription_status: 'expired',
        status: 'pending_subscription'
      })
      .eq('id', data.id);
    
    redirectTo = 'subscription';
  }
}
```

**ุงูููุงุฆุฏ:**
- โ ุงูุชุญูู ุงูููุฑู ูู ุตูุงุญูุฉ ุงูุงุดุชุฑุงู
- โ ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ููุน ุงููุตูู ูููุณุชุฎุฏููู ููุชูู ุงุดุชุฑุงููู

---

### 4๏ธโฃ **ุงุณุชุนูุงู SQL ูุญุณูู ูุน ุงูุชุญูู ุงููุฏูุฌ**

```sql
SELECT 
  u.id,
  u.username,
  u.email,
  u.role,
  u.status,
  u.subscription_status,
  u.subscription_end_date,
  s.id as subscription_id,
  s.status as subscription_table_status,
  s.end_date,
  -- โ ุงูุชุญูู ุงูููุฑู ูู ุตูุงุญูุฉ ุงูุงุดุชุฑุงู
  CASE 
    WHEN s.end_date IS NOT NULL AND s.end_date < NOW() THEN false
    ELSE true
  END as is_subscription_valid
FROM users u
LEFT JOIN subscriptions s ON u.id = s.user_id AND s.status = 'active'
WHERE u.id = '${userId}'
```

**ุงูููุงุฆุฏ:**
- โ ุงุณุชุนูุงู ูุงุญุฏ ุจุฏูุงู ูู ุนุฏุฉ ุงุณุชุนูุงูุงุช
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุฉ ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฃุฏุงุก ุฃุณุฑุน ุจูุซูุฑ

---

### 5๏ธโฃ **ุชุญุฏูุซ ูู ุฏูููุฉ ูู useSubscriptionStatus**

```typescript
useEffect(() => {
  checkSubscriptionStatus(false); // ุงูุชุญููู ุงูุฃููู
  
  // โ ุชุญุฏูุซ ูู ุฏูููุฉ ูุงุญุฏุฉ ูููุฒุงููุฉ ุงูุณุฑูุนุฉ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const interval = setInterval(() => {
    console.log('โก ุชุญุฏูุซ ุชููุงุฆู - ุงูุชุญูู ูู ุญุงูุฉ ุงูุงุดุชุฑุงู ูุงูุฏูุน...');
    checkSubscriptionStatus(true);
  }, 60 * 1000); // ูู ุฏูููุฉ
  
  return () => clearInterval(interval);
}, [userId]);
```

**ูุจู:** ูุงู ุงูุชุญุฏูุซ ูู 5 ุฏูุงุฆู  
**ุจุนุฏ:** ุงูุชุญุฏูุซ ูู ุฏูููุฉ ูุงุญุฏุฉ โก

---

### 6๏ธโฃ **ุชูููู Timeout ููุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ**

```typescript
// ูุจู: 3000ms (3 ุซูุงูู)
const timeoutPromise = new Promise((_, reject) => 
  setTimeout(() => reject(new Error('Session timeout')), 3000)
);

// ุจุนุฏ: 2000ms (ุซุงููุชุงู) โก
const timeoutPromise = new Promise((_, reject) => 
  setTimeout(() => reject(new Error('Session timeout')), 2000)
);
```

---

## ๐ **ุงูููุงุฑูุฉ:**

| ุงููููุงุณ | ูุจู | ุจุนุฏ | ุงูุชุญุณูู |
|---------|-----|-----|---------|
| **ุชุญุฏูุซ ุงูุงุดุชุฑุงู** | 5 ุฏูุงุฆู | **1 ุฏูููุฉ** | **5x ุฃุณุฑุน** |
| **Timeout** | 3 ุซูุงูู | **2 ุซุงููุฉ** | **33% ุฃุณุฑุน** |
| **ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช** | 2-3 | **1** | **3x ุฃูู** |
| **ุงูุชุญูู ูู ุงูุตูุงุญูุฉ** | ูุฏูู | **ุชููุงุฆู** | **ููุฑู** |
| **ุงููุฒุงููุฉ** | ูุฏููุฉ | **ุชููุงุฆูุฉ** | **100%** |

---

## ๐ฏ **ุงูุณููุงุฑูููุงุช:**

### **1๏ธโฃ ูุณุชุฎุฏู ูุดุชุฑู ูุฃูู ูุฑุฉ:**

```
1. ุงููุณุชุฎุฏู ูุฏูุน ุจูุฌุงุญ โ
   โ
2. ูุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   - subscription_status = 'active'
   - status = 'active'
   โ
3. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ (ุฎูุงู ุฏูููุฉ):
   - refreshUserData() ุชุฌูุจ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
   - ูุชู ุชุญุฏูุซ ุงููุงุฌูุฉ ุชููุงุฆูุงู
   โ
4. ุงููุณุชุฎุฏู ูุฑู ููุญุฉ ุงูุชุญูู ูุจุงุดุฑุฉ โ
```

---

### **2๏ธโฃ ุงุดุชุฑุงู ููุชูู:**

```
1. ุชุงุฑูุฎ ุงูุงูุชูุงุก ููุฑ โฐ
   โ
2. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ (ุฎูุงู ุฏูููุฉ):
   - ุงูุชุญูู ูู subscription_end_date
   - ุงูุชุดุงู ุฃู ุงูุงุดุชุฑุงู ููุชูู
   โ
3. ุชุญุฏูุซ ุชููุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   - subscription_status = 'expired'
   - status = 'pending_subscription'
   โ
4. ุชูุฌูู ุงููุณุชุฎุฏู ูุตูุญุฉ ุงูุงุดุชุฑุงู โ
```

---

### **3๏ธโฃ ูุณุชุฎุฏู ูุฌุฏุฏ ุงุดุชุฑุงูู:**

```
1. ุงููุณุชุฎุฏู ูุฏูุน ููุชุฌุฏูุฏ โ
   โ
2. ูุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:
   - subscription_end_date = ุชุงุฑูุฎ ุฌุฏูุฏ
   - subscription_status = 'active'
   โ
3. ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ (ุฎูุงู ุฏูููุฉ):
   - refreshUserData() ุชุฌูุจ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
   - ูุชู ุชุญุฏูุซ ุงููุงุฌูุฉ
   โ
4. ุงููุณุชุฎุฏู ูุณุชูุฑ ูู ุงุณุชุฎุฏุงู ููุญุฉ ุงูุชุญูู โ
```

---

## ๐ง **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ุชุญุฏูุซ ูุฏูู ููุฑู:**

```typescript
import { authService } from './services/simpleAuthService';

// ูู ุฃู ููุงู ูู ุงูุชุทุจูู
await authService.refreshUserData();
```

### **ุชุญุฏูุซ ุญุงูุฉ ุงูุงุดุชุฑุงู:**

```typescript
import { useSubscriptionStatus } from './hooks/useSubscriptionStatus';

const { status, refresh } = useSubscriptionStatus(userId);

// ุชุญุฏูุซ ูุฏูู
refresh();
```

---

## โ **ุงูุถูุงูุงุช:**

1. โ **ูุฒุงููุฉ ุชููุงุฆูุฉ ูู ุฏูููุฉ** - ูุง ุญุงุฌุฉ ููุชุญุฏูุซ ุงููุฏูู
2. โ **ุงูุชุญูู ุงูููุฑู ูู ุงูุตูุงุญูุฉ** - ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ
3. โ **ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุฉ** - ุนูุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู
4. โ **ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ** - timeout ุฃููุ ุงุณุชุนูุงูุงุช ุฃุณุฑุน
5. โ **ูุง ุชุฃุฎูุฑ** - ุงููุณุชุฎุฏู ูุฑู ุงูุชุญุฏูุซุงุช ููุฑุงู

---

## ๐ **ุงููููุงุช ุงููุญุฏุซุฉ:**

1. โ `src/services/simpleAuthService.ts`:
   - ุฅุถุงูุฉ `startAutoSync()` - ูุฒุงููุฉ ุชููุงุฆูุฉ ูู ุฏูููุฉ
   - ุฅุถุงูุฉ `refreshUserData()` - ุชุญุฏูุซ ููุฑู
   - ุชุญุณูู `loadUserData()` - ุงูุชุญูู ูู ุชุงุฑูุฎ ุงูุงูุชูุงุก
   - ุชูููู timeout ูู 3000ms ุฅูู 2000ms

2. โ `src/hooks/useSubscriptionStatus.ts`:
   - ุชุญุฏูุซ ูู ุฏูููุฉ ุจุฏูุงู ูู 5 ุฏูุงุฆู
   - ุงุณุชุนูุงู SQL ูุญุณูู ูุน `is_subscription_valid`
   - ุงูุชุญูู ุงููุฒุฏูุฌ ูู ุชุงุฑูุฎ ุงูุงูุชูุงุก

---

## ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

โ **ูุฒุงููุฉ ููุฑูุฉ** ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุชุทุจูู  
โ **ุชุญูู ุณุฑูุน** ูู ุญุงูุฉ ุงูุงุดุชุฑุงู ูุงูุฏูุน  
โ **ุชุญุฏูุซ ุชููุงุฆู** ูููุงุฌูุฉ ุจุฏูู ุฅุนุงุฏุฉ ุชุญููู  
โ **ุฃุฏุงุก ูุญุณูู** - ุงุณุชุนูุงูุงุช ุฃูู ูุฃุณุฑุน  
โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ** - ูุง ุชุฃุฎูุฑุ ูุง ุงูุชุธุงุฑ

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

1. **ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ** ุชุนูู ููุท ุนูุฏูุง ูููู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู
2. **ุงูุชุญุฏูุซ ุงูููุฑู** ูุญุฏุซ ูู ุงูุฎูููุฉ ุจุฏูู ุฅุฒุนุงุฌ ุงููุณุชุฎุฏู
3. **ุงูุชุญูู ูู ุงูุตูุงุญูุฉ** ูุชู ุนูู ูุณุชูููู:
   - ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (SQL)
   - ูู JavaScript (ููุชุฃููุฏ)
4. **ุงูุฃุฏุงุก** ูุญุณูู ุจุดูู ูุจูุฑ - ุงุณุชุนูุงู ูุงุญุฏ ุจุฏูุงู ูู ุนุฏุฉ ุงุณุชุนูุงูุงุช

---

## ๐งช **ุงูุงุฎุชุจุงุฑ:**

### **ุงุฎุชุจุงุฑ ุงููุฒุงููุฉ:**
1. ุณุฌู ุฏุฎูู ููุณุชุฎุฏู
2. ุงูุชุญ Developer Tools โ Console
3. ุฑุงูุจ ุงูุฑุณุงุฆู:
   ```
   ๐ ูุฒุงููุฉ ุชููุงุฆูุฉ - ุงูุชุญูู ูู ุชุญุฏูุซุงุช ุงูุงุดุชุฑุงู ูุงูุฏูุน...
   โก ุชุญุฏูุซ ููุฑู ูุจูุงูุงุช ุงููุณุชุฎุฏู...
   โ ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุจูุฌุงุญ
   ```

### **ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงูุงุดุชุฑุงู:**
1. ุบููุฑ `subscription_end_date` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุงุฑูุฎ ูุงุถู
2. ุงูุชุธุฑ ุฏูููุฉ ูุงุญุฏุฉ
3. ูุฌุจ ุฃู ูุชู ุชูุฌููู ุชููุงุฆูุงู ูุตูุญุฉ ุงูุงุดุชุฑุงู

### **ุงุฎุชุจุงุฑ ุงูุชุฌุฏูุฏ:**
1. ุงุฏูุน ููุชุฌุฏูุฏ
2. ุงูุชุธุฑ ุฏูููุฉ ูุงุญุฏุฉ
3. ูุฌุจ ุฃู ูุชู ุชุญุฏูุซ ุงููุงุฌูุฉ ุชููุงุฆูุงู

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
