# قائمة اختبار التدفق الكامل

## ✅ قائمة التحقق الشاملة

### 1️⃣ اختبار التسجيل
- [ ] فتح التطبيق والوصول للصفحة الرئيسية
- [ ] الضغط على "تسجيل حساب جديد"
- [ ] إدخال جميع البيانات المطلوبة:
  - [ ] البريد الإلكتروني
  - [ ] اسم المستخدم
  - [ ] الاسم الكامل
  - [ ] الدولة
  - [ ] كلمة المرور
- [ ] التحقق من إنشاء السجل في جدول `users`
- [ ] التحقق من الحالة الأولية:
  - [ ] `email_verified = false`
  - [ ] `is_active = false`
  - [ ] `status = 'pending_email_verification'`
  - [ ] `subscription_status = 'inactive'`

### 2️⃣ اختبار تفعيل البريد الإلكتروني
- [ ] التوجه التلقائي لصفحة تفعيل البريد
- [ ] استلام رمز التفعيل في البريد
- [ ] إدخال الرمز الصحيح
- [ ] التحقق من تحديث قاعدة البيانات:
  - [ ] `email_verified = true`
  - [ ] `status = 'pending_subscription'`
- [ ] التوجه التلقائي لصفحة الاشتراك

### 3️⃣ اختبار اختيار الباقة
- [ ] عرض جميع الباقات المتاحة
- [ ] اختيار باقة معينة
- [ ] التوجه المباشر لصفحة الدفع
- [ ] عرض ملخص الطلب بشكل صحيح

### 4️⃣ اختبار الدفع بـ PayPal
- [ ] اختيار طريقة الدفع PayPal
- [ ] الضغط على زر "الدفع بـ PayPal"
- [ ] محاكاة الدفع الناجح
- [ ] التحقق من إنشاء السجلات:
  - [ ] سجل في جدول `payments`:
    - [ ] `payment_method = 'paypal'`
    - [ ] `status = 'completed'`
    - [ ] `admin_review_status = 'approved'`
  - [ ] سجل في جدول `subscriptions`:
    - [ ] `status = 'active'`
  - [ ] تحديث جدول `users`:
    - [ ] `status = 'active'`
    - [ ] `subscription_status = 'active'`
    - [ ] `is_active = true`
- [ ] التوجه لصفحة النجاح
- [ ] **اختبار تسجيل الدخول**:
  - [ ] محاولة تسجيل الدخول
  - [ ] التحقق من السماح بالدخول
  - [ ] الوصول للوحة التحكم

### 5️⃣ اختبار الدفع بالبطاقة البنكية
- [ ] اختيار طريقة الدفع "بطاقة بنكية"
- [ ] فتح نافذة إدخال بيانات البطاقة
- [ ] إدخال البيانات:
  - [ ] رقم البطاقة
  - [ ] تاريخ الانتهاء
  - [ ] CVV
  - [ ] اسم حامل البطاقة
- [ ] محاكاة الدفع الناجح
- [ ] التحقق من نفس خطوات PayPal
- [ ] **اختبار تسجيل الدخول**

### 6️⃣ اختبار الدفع بالعملات الرقمية
#### أ) رفع الصورة
- [ ] اختيار طريقة الدفع "عملة رقمية"
- [ ] عرض عنوان المحفظة بشكل صحيح
- [ ] عرض المبلغ المطلوب
- [ ] رفع صورة إثبات الدفع:
  - [ ] اختيار صورة (JPG/PNG/GIF)
  - [ ] التحقق من حجم الصورة (< 5MB)
  - [ ] رفع الصورة بنجاح
- [ ] التحقق من إنشاء السجلات:
  - [ ] سجل في جدول `payments`:
    - [ ] `payment_method = 'bitcoin'` أو `'crypto'`
    - [ ] `status = 'reviewing'`
    - [ ] `admin_review_status = 'pending'`
    - [ ] `crypto_proof_image` يحتوي على رابط الصورة
  - [ ] سجل في جدول `subscriptions`:
    - [ ] `status = 'inactive'`
  - [ ] تحديث جدول `users`:
    - [ ] `status = 'payment_pending_review'`
    - [ ] `subscription_status = 'inactive'`
    - [ ] `is_active = false`
- [ ] التوجه لصفحة مراجعة الدفع

#### ب) صفحة مراجعة الدفع
- [ ] عرض حالة "قيد المراجعة"
- [ ] عرض معلومات الدفع بشكل صحيح
- [ ] التحديث التلقائي كل 30 ثانية
- [ ] زر التحقق اليدوي يعمل
- [ ] **اختبار محاولة تسجيل الدخول**:
  - [ ] محاولة تسجيل الدخول
  - [ ] التحقق من رفض الدخول
  - [ ] عرض رسالة "دفعتك قيد المراجعة"

### 7️⃣ اختبار لوحة الإدارة - موافقة الدفع
#### أ) الوصول للوحة الإدارة
- [ ] تسجيل الدخول كأدمن
- [ ] الوصول للوحة الإدارة
- [ ] فتح تبويب "إدارة المدفوعات"

#### ب) عرض المدفوعات
- [ ] عرض جميع المدفوعات
- [ ] عرض الإحصائيات بشكل صحيح:
  - [ ] الإجمالي
  - [ ] قيد المراجعة
  - [ ] مكتملة
  - [ ] الإيرادات
- [ ] البحث والتصفية يعملان

#### ج) عرض صورة إثبات الدفع
- [ ] الضغط على زر "عرض"
- [ ] فتح نافذة عرض الصورة
- [ ] عرض الصورة بشكل صحيح
- [ ] عرض معلومات الدفع

#### د) الموافقة على الدفع
- [ ] الضغط على زر "موافقة"
- [ ] التحقق من تحديث قاعدة البيانات:
  - [ ] جدول `payments`:
    - [ ] `status = 'completed'`
    - [ ] `admin_review_status = 'approved'`
    - [ ] `reviewed_by` = معرف الأدمن
    - [ ] `reviewed_at` = الوقت الحالي
  - [ ] جدول `subscriptions`:
    - [ ] `status = 'active'`
  - [ ] جدول `users`:
    - [ ] `status = 'active'`
    - [ ] `subscription_status = 'active'`
    - [ ] `is_active = true`
- [ ] عرض رسالة نجاح

#### هـ) التحقق من صفحة المراجعة (للمستخدم)
- [ ] تحديث صفحة المراجعة تلقائياً
- [ ] عرض حالة "تمت الموافقة"
- [ ] عرض زر "تسجيل الدخول الآن"

#### و) اختبار تسجيل الدخول بعد الموافقة
- [ ] الضغط على "تسجيل الدخول الآن"
- [ ] إدخال بيانات الدخول
- [ ] التحقق من السماح بالدخول
- [ ] الوصول للوحة التحكم

### 8️⃣ اختبار لوحة الإدارة - رفض الدفع
#### أ) رفض الدفع
- [ ] الضغط على زر "رفض"
- [ ] التحقق من تحديث قاعدة البيانات:
  - [ ] جدول `payments`:
    - [ ] `status = 'failed'`
    - [ ] `admin_review_status = 'rejected'`
    - [ ] `reviewed_by` = معرف الأدمن
    - [ ] `reviewed_at` = الوقت الحالي
  - [ ] جدول `subscriptions`:
    - [ ] `status = 'cancelled'`
  - [ ] جدول `users`:
    - [ ] `status = 'pending_payment'`
    - [ ] `subscription_status = 'inactive'`
    - [ ] `is_active = false`
- [ ] عرض رسالة نجاح

#### ب) التحقق من صفحة المراجعة (للمستخدم)
- [ ] تحديث صفحة المراجعة تلقائياً
- [ ] عرض حالة "تم الرفض"
- [ ] عرض سبب الرفض (إن وجد)
- [ ] عرض زر "إعادة المحاولة"

#### ج) اختبار محاولة تسجيل الدخول بعد الرفض
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من رفض الدخول
- [ ] عرض رسالة خطأ مناسبة

### 9️⃣ اختبار الحماية على تسجيل الدخول
#### أ) محاولة الدخول بدون تفعيل البريد
- [ ] إنشاء حساب جديد
- [ ] عدم تفعيل البريد
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من رفض الدخول
- [ ] عرض رسالة "يجب تفعيل البريد الإلكتروني أولاً"

#### ب) محاولة الدخول بدون اشتراك
- [ ] تفعيل البريد
- [ ] عدم اختيار باقة
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من رفض الدخول
- [ ] عرض رسالة "يجب إكمال الاشتراك والدفع"

#### ج) محاولة الدخول مع دفع قيد المراجعة
- [ ] اختيار باقة
- [ ] الدفع بالعملات الرقمية
- [ ] رفع الصورة
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من رفض الدخول
- [ ] عرض رسالة "دفعتك قيد المراجعة"

#### د) محاولة الدخول بعد رفض الدفع
- [ ] الأدمن يرفض الدفع
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من رفض الدخول
- [ ] عرض رسالة مناسبة

#### هـ) الدخول الناجح
- [ ] الأدمن يوافق على الدفع
- [ ] محاولة تسجيل الدخول
- [ ] التحقق من السماح بالدخول
- [ ] الوصول للوحة التحكم

### 🔟 اختبار الأدمن
#### أ) دخول الأدمن بدون شروط
- [ ] تسجيل الدخول بحساب الأدمن
- [ ] التحقق من السماح بالدخول دائماً
- [ ] عدم التحقق من الاشتراك

#### ب) صلاحيات الأدمن
- [ ] الوصول للوحة الإدارة
- [ ] عرض جميع المدفوعات
- [ ] عرض جميع الاشتراكات
- [ ] الموافقة/رفض الدفعات

---

## 🔍 نقاط التحقق الإضافية

### الأمان
- [ ] RLS مفعل على جميع الجداول
- [ ] المستخدم العادي لا يمكنه رؤية بيانات مستخدمين آخرين
- [ ] الأدمن فقط يمكنه الوصول لجميع البيانات
- [ ] التحقق من الصلاحيات قبل كل عملية

### تجربة المستخدم
- [ ] رسائل الخطأ واضحة ومفهومة
- [ ] التنقل بين الصفحات سلس
- [ ] التحديث التلقائي يعمل بشكل صحيح
- [ ] الأزرار والنماذج تستجيب بشكل صحيح

### قاعدة البيانات
- [ ] جميع الجداول موجودة
- [ ] الفهارس معرفة بشكل صحيح
- [ ] الدوال تعمل بشكل صحيح
- [ ] Triggers تعمل بشكل صحيح

### الملفات
- [ ] جميع الملفات موجودة
- [ ] لا توجد أخطاء في الكود
- [ ] الاستيراد والتصدير صحيح

---

## 📊 سيناريوهات الاختبار الكاملة

### السيناريو 1: مستخدم جديد - دفع PayPal
1. فتح التطبيق
2. التسجيل
3. تفعيل البريد
4. اختيار باقة
5. الدفع بـ PayPal
6. تسجيل الدخول ✅

### السيناريو 2: مستخدم جديد - دفع بطاقة
1. فتح التطبيق
2. التسجيل
3. تفعيل البريد
4. اختيار باقة
5. الدفع بالبطاقة
6. تسجيل الدخول ✅

### السيناريو 3: مستخدم جديد - دفع عملات رقمية (موافقة)
1. فتح التطبيق
2. التسجيل
3. تفعيل البريد
4. اختيار باقة
5. الدفع بالعملات الرقمية
6. رفع الصورة
7. صفحة المراجعة (قيد المراجعة)
8. محاولة تسجيل الدخول ❌
9. الأدمن يوافق على الدفع
10. تحديث صفحة المراجعة (تمت الموافقة)
11. تسجيل الدخول ✅

### السيناريو 4: مستخدم جديد - دفع عملات رقمية (رفض)
1. فتح التطبيق
2. التسجيل
3. تفعيل البريد
4. اختيار باقة
5. الدفع بالعملات الرقمية
6. رفع الصورة
7. صفحة المراجعة (قيد المراجعة)
8. محاولة تسجيل الدخول ❌
9. الأدمن يرفض الدفع
10. تحديث صفحة المراجعة (تم الرفض)
11. محاولة تسجيل الدخول ❌

---

## ⚠️ الأخطاء المحتملة

### أخطاء التسجيل
- [ ] البريد الإلكتروني موجود بالفعل
- [ ] اسم المستخدم موجود بالفعل
- [ ] كلمة مرور ضعيفة

### أخطاء تفعيل البريد
- [ ] رمز تفعيل خاطئ
- [ ] رمز منتهي الصلاحية

### أخطاء الدفع
- [ ] صورة كبيرة جداً (> 5MB)
- [ ] صيغة صورة غير مدعومة
- [ ] فشل في رفع الصورة

### أخطاء تسجيل الدخول
- [ ] اسم مستخدم/بريد خاطئ
- [ ] كلمة مرور خاطئة
- [ ] البريد غير مفعل
- [ ] لا يوجد اشتراك
- [ ] الدفع قيد المراجعة
- [ ] الحساب محظور

---

## ✅ معايير النجاح

- [ ] جميع السيناريوهات تعمل بشكل صحيح
- [ ] لا توجد أخطاء في Console
- [ ] قاعدة البيانات تتحدث بشكل صحيح
- [ ] الحماية تعمل بشكل صحيح
- [ ] تجربة المستخدم سلسة
- [ ] الأدمن يمكنه إدارة المدفوعات

---

**تاريخ الاختبار**: _____________
**المختبر**: _____________
**النتيجة**: ⬜ نجح ⬜ فشل
**الملاحظات**: _____________
