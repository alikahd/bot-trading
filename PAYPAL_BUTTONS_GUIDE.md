# دليل أزرار الدفع PayPal

## نظرة عامة
تم تفعيل زرين للدفع في صفحة الدفع:
1. **زر PayPal** (الذهبي) - للدفع بحساب PayPal
2. **زر البطاقة** (الأسود) - للدفع بالبطاقة البنكية عبر PayPal

## كيفية العمل

### 1. زر PayPal (الذهبي)
- عند الضغط على هذا الزر، يتم فتح نافذة PayPal
- يمكن للمستخدم:
  - تسجيل الدخول بحساب PayPal والدفع
  - أو اختيار "الدفع بالبطاقة" من داخل نافذة PayPal

### 2. زر البطاقة (الأسود)
- عند الضغط على هذا الزر، يتم فتح نافذة PayPal مباشرة لإدخال بيانات البطاقة
- يعرض حقول إدخال البطاقة:
  - رقم البطاقة
  - تاريخ الانتهاء
  - CVV
  - الاسم على البطاقة
- يتم معالجة الدفع بشكل آمن عبر PayPal بدون الحاجة لحساب PayPal

## الإعدادات المطلوبة

### 1. ملف `.env`
يجب إضافة بيانات PayPal في ملف `.env`:
```env
PAYPAL_CLIENT_ID=your_paypal_client_id_here
PAYPAL_CLIENT_SECRET=your_paypal_client_secret_here
```

### 2. تشغيل السيرفر
يجب تشغيل سيرفر PayPal للمعالجة:
```bash
node server/index.js
```

## الملفات المعدلة

### 1. `src/services/paypalService.ts`
- تم تحديث URL الخاص بـ PayPal SDK
- تم إضافة `hosted-fields` للحقول المخصصة
- تم تفعيل `enable-funding=card` لدعم البطاقات
- تم تعطيل `credit` و `paylater` لتبسيط الخيارات

### 2. `src/components/payments/PayPalButtons.tsx`
- تم تحسين عرض الأزرار
- تم إضافة معالجة أفضل للأخطاء
- تم تحسين رسائل الحالة

### 3. `src/types/global.d.ts`
- تم إضافة دعم `HostedFields` في تعريفات الأنواع
- تم إضافة `PAYLATER` في FUNDING

### 4. `server/index.js`
- يحتوي على endpoints لمعالجة الدفع:
  - `/api/paypal/create-order` - إنشاء طلب دفع
  - `/api/paypal/capture-order` - التقاط الدفع
  - `/api/paypal/client-token` - للحقول المخصصة

## سير العمل

### عند اختيار الدفع بـ PayPal:
1. المستخدم يضغط على الزر الذهبي
2. تفتح نافذة PayPal
3. يسجل الدخول بحساب PayPal
4. يوافق على الدفع
5. يتم التقاط الدفع وتحديث الاشتراك

### عند اختيار الدفع بالبطاقة:
1. المستخدم يضغط على الزر الأسود
2. تفتح نافذة PayPal لإدخال بيانات البطاقة
3. يدخل بيانات البطاقة (رقم، تاريخ، CVV)
4. يوافق على الدفع
5. يتم التقاط الدفع وتحديث الاشتراك

## ملاحظات مهمة

### الأمان
- جميع المدفوعات تتم عبر PayPal بشكل آمن
- لا يتم تخزين بيانات البطاقة في التطبيق
- يتم استخدام HTTPS لجميع الاتصالات

### البيئة
- حالياً يعمل في بيئة الإنتاج (Production)
- URL: `https://api-m.paypal.com`
- للاختبار، يمكن تغيير URL إلى: `https://api-m.sandbox.paypal.com`

### معالجة الأخطاء
- إذا فشل تحميل زر البطاقة، يتم عرض رسالة توجيهية
- يمكن للمستخدم دائماً استخدام زر PayPal كبديل
- جميع الأخطاء يتم تسجيلها في Console

## الاختبار

### اختبار زر PayPal:
1. افتح صفحة الدفع
2. اضغط على الزر الذهبي
3. تحقق من فتح نافذة PayPal
4. جرب تسجيل الدخول أو الدفع كضيف

### اختبار زر البطاقة:
1. افتح صفحة الدفع
2. اضغط على الزر الأسود
3. تحقق من ظهور حقول إدخال البطاقة
4. جرب إدخال بيانات اختبارية

### بطاقات اختبار PayPal:
```
رقم البطاقة: 4111 1111 1111 1111
تاريخ الانتهاء: أي تاريخ مستقبلي
CVV: أي 3 أرقام
```

## الدعم الفني

إذا واجهت أي مشاكل:
1. تحقق من Console للأخطاء
2. تأكد من تشغيل السيرفر
3. تحقق من صحة بيانات PayPal في `.env`
4. تأكد من الاتصال بالإنترنت

## التحديثات المستقبلية

يمكن إضافة:
- دعم Apple Pay
- دعم Google Pay
- دعم Venmo
- حقول بطاقة مخصصة (Hosted Fields) مدمجة في الصفحة
